<!--Dashboard HTML Starts-->
<div class="dashboard-gutter">
    <div class="container-fluid px-lg-0" data-layout="container-fluid">


        <div class="dashboard-content">

            <app-inner-header></app-inner-header>
            <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }"></ngx-loading>
            <div class="Dashboard-inner-contents">
                <div class="row ipad-margin-gutter">
                    <div class="col-md-12">
                        <div class="Dashboard-inner-contents-outer">
                            <div class="row">
                                <div class="col-lg-12 col-xl-12 mx-auto mb-4 mb-lg-0">
                                    <!--Project HTML starts-->
                                    <div class="row">

                                        <div class="col-md-12 ">
                                            <h4 class="create-project-top-heading">Ticket Details</h4>
                                            <div class="dashboard-latest-project-outer">
                                                <div class="row">
                                                    <div class="col-lg-12 px-lg-3 p-0">
                                                        <div class="my-dashboard-project-main">
                                                            <h2 class="dashboard-latest-project-title">
                                                                Subject: {{supportData?.support[0]?.subject}}</h2>

                                                            <h6 class="dashboard-latest-project-subject">
                                                                Ticket: {{supportData?.support[0]?.code}}</h6>
                                                            <h6 class="dashboard-latest-project-subject mt-3">
                                                                Submitted On:
                                                                {{supportData?.support[0]?.created_on | date}}
                                                            </h6>
                                                            <h6 class="dashboard-latest-project-subject mt-3">
                                                                Status :
                                                                <span
                                                                    [ngClass]="supportData?.support[0]?.support_status == 'solved' ? 'solved':'unsolved'"
                                                                    class="text ">{{supportData?.support[0]?.support_status}}</span>
                                                            </h6>

                                                            <div class="row">
                                                                <div class="col-md-12">

                                                                    <div class="">



                                                                        <div class="description_list">
                                                                            <h4></h4>
                                                                        </div>

                                                                        <div class="msg-group center">

                                                                            <div
                                                                                *ngFor="let message of supportData?.messages;let i = index;">
                                                                                <div *ngIf="message.instanciate_id == 0"
                                                                                    class="dispute_media">

                                                                                    <div
                                                                                        class="card-body dispute_left dispute_right-content mw-100">
                                                                                        <h6 class="card-subtitle">
                                                                                            {{supportData?.director[0]?.director_name}}
                                                                                        </h6>

                                                                                        <span
                                                                                            class="card-text float-left ticket--span-date">{{message?.cur_date | date}}</span>
                                                
                                                <p *ngIf="(message?.message) && (message?.message.length >= 1) && expandAdminTicketData == false" class="ticket--span-p line--clamp">{{message?.message}}</p>
                    <span *ngIf="(message?.message) && (message?.message.length >= 385) && expandAdminTicketData == false" class="expand_data" (click)="expandAdminTicketData = true">read more</span> 
                    <p *ngIf="expandAdminTicketData == true" class="ticket--span-p white--space">{{message?.message}}</p>
                    <span *ngIf="(message?.message) && (message?.message.length >= 385) && expandAdminTicketData == true" class="expand_data" (click)="expandAdminTicketData = false">read less</span>
                                                                                        

                                                                                        <a class=" ticket--download float-left"
                                                                                            *ngIf="message?.support_file"
                                                                                            href="{{ message?.support_file }}"
                                                                                            target="_blank">Download
                                                                                            Attachment</a>
                                                                                    </div>
                                                                                </div>

                                                                                <div *ngIf="message.instanciate_id > 0"
                                                                                    class="dispute_media flex-row-reverse">

                                                                                    <div
                                                                                        class="card-body dispute_left dispute_right-contents">
                                                                                        <h6 class="card-subtitle">
                                                                                            {{supportData?.user?.first_name}}
                                                                                            {{supportData?.user?.last_name}}
                                                                                        </h6>
                                                                                        <span
                                                                                            class="card-text float-right ticket--span-date">{{message?.cur_date | date}}</span>
                    <p *ngIf="(message?.message) && (message?.message.length >= 1) && expandUserTicketData == false" class="ticket--span-p line--clamp">{{message?.message}}</p>
                    <span *ngIf="(message?.message) && (message?.message.length >= 385) && expandUserTicketData == false" class="expand_data" (click)="expandUserTicketData = true">read more</span> 
                    <p *ngIf="expandUserTicketData == true" class="ticket--span-p white--space">{{message?.message}}</p>
                    <span *ngIf="(message?.message) && (message?.message.length >= 385) && expandUserTicketData == true" class="expand_data" (click)="expandUserTicketData = false">read less</span>
                                                                                        <a class="ticket--download"
                                                                                            *ngIf="message?.support_file"
                                                                                            href="{{ message?.support_file }}"
                                                                                            target="_blank">Download
                                                                                            Attachment</a>
                                                                                    </div>
                                                                                </div>

                                                                            </div>





                                                                        </div>

                                                                        <div class="description_list"
                                                                            [hidden]="supportData?.support[0]?.support_status == 'solved'">
                                                                            <h4>Discussions</h4>
                                                                        </div>
                                                                        <div
                                                                            [hidden]="supportData?.support[0]?.support_status == 'solved'">
                                                                            <form [formGroup]="ticketReplyForm"
                                                                                class="dispute_form">
                                                                                <textarea placeholder="Message"
                                                                                    formControlName="message"
                                                                                    name="message" rows="10"
                                                                                    cols="20"></textarea>
                                                                                <p
                                                                                    *ngIf="ticketReplyForm.controls.message.touched || isSubmitted">
                                                                                    <app-form-validation-errors
                                                                                        errorPrefix="Message "
                                                                                        [errors]="ticketReplyForm.controls.message.errors">
                                                                                    </app-form-validation-errors>
                                                                                </p>
                                                                                <div class="row">
                                                                                    <div class="col-lg-5">
                                                                                        <div
                                                                                            class="col-lg-12 col-lg-12 step-progress-fields">
                                                                                            <label>Attach File?</label>
                                                                                            <div class="uploadcode">
                                                                                                <div
                                                                                                    class="uploadImages position-relative">
                                                                                                    <div class="dropzone dropzone-container"
                                                                                                        [dropzone]="supportFileConfiguration"
                                                                                                        [disabled]="disabled">
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>

                                                                                        <!--Upload Images Section-->
                                                                                        <div class="col-md-12">


                                                                                            <div class="thumbnails"
                                                                                                *ngIf="checkObjectLength(supportFilesArray.value) > 0">
                                                                                                <div class="thumbnail_list"
                                                                                                    *ngFor="let supportFile of supportFilesArray.value | keyvalue; let i = index;">


                                                                                                    <a class="upload_pdf"
                                                                                                        data-toggle="tooltip"
                                                                                                        title="{{supportFile.value.file_name}}"
                                                                                                        href="{{supportFile.value.file_path}}"
                                                                                                        target="_blank">

                                                                                                        <img *ngIf="supportFile.value.file_mimetype == 'application/pdf'"
                                                                                                            src="assets/image/pdf.png">
                                                                                                        <img *ngIf="supportFile.value.file_mimetype == 'text/plain'"
                                                                                                            src="assets/image/txt.png">
                                                                                                        <img *ngIf="(supportFile.value.file_mimetype == 'text/csv')
                                                                                            ||
                                                                                            (supportFile.value.file_mimetype == 'application/vnd.ms-excel')
                                                                                            || (supportFile.value.file_mimetype == 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')"
                                                                                                            src="assets/image/csv.png">

                                                                                                        <img *ngIf="(supportFile.value.file_mimetype == 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') || (supportFile.value.file_mimetype == 'application/msword')"
                                                                                                            src="assets/image/word.png">

                                                                                                        <img *ngIf="(supportFile.value.file_mimetype == 'application/zip') || (supportFile.value.file_mimetype == 'application/x-rar-compressed') || (supportFile.value.file_mimetype == 'application/vnd.rar') || (supportFile.value.file_mimetype == 'application/octet-stream') || (supportFile.value.file_mimetype == 'application/x-zip-compressed')"
                                                                                                            src="assets/image/zip.png">

                                                                                                    </a>

                                                                                                    <i (click)="removeFile(supportFile.key, 'support',supportFile.value.file_key)"
                                                                                                        class="fa fa-times"
                                                                                                        aria-hidden="true"></i>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>

                                                                                        <!--Upload Images Section-->

                                                                                    </div>
                                                                                    <div
                                                                                        class="col-lg-6 offset-lg-1 send--rply-btn">
                                                                                        <a type="button"
                                                                                            (click)="submitReply()"
                                                                                            class="btn btn-danger">Send
                                                                                            Reply</a>
                                                                                    </div>
                                                                                </div>

                                                                                <div
                                                                                    class="col-lg-12 px-0 solving--btn-outer text-right">

                                                                                    <p class="close--ticketpoint"> Click
                                                                                        the close ticket button if the
                                                                                        ticket is solved »</p>
                                                                                    <button type="button"
                                                                                        (click)="solveTicket()"
                                                                                        class="btn btn-danger">Close
                                                                                        Ticket
                                                                                    </button>
                                                                                </div>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>


                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <!--Project HTML ends-->

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!--Dashboard HTML Ends-->
</div>